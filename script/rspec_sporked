#!/usr/bin/env ruby
#
# This file was generated by RubyGems.
#
# The application 'rspec-core' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'rubygems'

version = ">= 0"

def remove_arg(list, key, value)
  list.each_with_index do |arg, index|
    if arg == key && list[index+1] == value
      list.delete_at(index)
      list.delete_at(index)
    end
  end
end

remove_arg ARGV, '--require', 'teamcity/spec/runner/formatter/teamcity/formatter'
remove_arg ARGV, '--format', 'Spec::Runner::Formatter::TeamcityFormatter'

spec = Gem::Specification.find_by_name("guard-rspec")

command_line = %W(
  --color
  --failure-exit-code 2
  --format progress
  --format Guard::RSpec::Formatter::NotificationRSpec
  --require #{ENV['GEM_HOME']}/gems/guard-rspec-#{spec.version}/lib/guard/rspec/formatters/notification_rspec.rb
  --out /dev/null
  --drb
)

command_line.each do |arg|
  ARGV << arg
end

puts "Running `sporked` rspec..."

if ARGV.first =~ /^_(.*)_$/ and Gem::Version.correct? $1 then
  version = $1
  ARGV.shift
end

gem 'rspec-core', version
load Gem.bin_path('rspec-core', 'rspec', version)
